KISSY.add("tbc/search-suggest/1.4.5/index",["combobox","base","json","cookie","event","node","rich-base","dom"],function(e,t,a,r){var n,i,s,o,u,c,l,f,d=t("combobox"),g=t("base"),p=t("json"),h=(t("cookie"),t("event")),m=t("node"),v=t("rich-base"),b=t("dom");n=function(t){function a(e){a.superclass.constructor.call(this,e||{})}var r=d;return a=r.extend({initializer:function(){var e=this;e.on("afterRenderData",function(){e.fire("beforeShow")})},sendRequest:function(e){var t=this,a=t.constructor.superclass.sendRequest;if(t.fire("beforeQueryChange",{query:e})===!1)return!1;t.queryTimer&&clearTimeout(t.queryTimer),t.laterTimer&&clearTimeout(t.laterTimer);var r=arguments;t.queryTimer=setTimeout(function(){t.queryTimer=null,t.laterTimer=setTimeout(function(){t.later=!1},500),a.apply(t,r)},t.later?200:50),t.later=!0},handleKeyDownInternal:function(e){var t=this,a=t.constructor.superclass.handleKeyDownInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void a.apply(this,arguments)},handleKeyEventInternal:function(e){var t=this,a=t.constructor.superclass.handleKeyEventInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void a.apply(this,arguments)},setValueInternal:function(e){var t=this,a=t.constructor.superclass.setValueInternal;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void a.apply(this,arguments)},setValueFromAutocomplete:function(e){var t=this,a=t.constructor.superclass.setValueFromAutocomplete;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void a.apply(this,arguments)},renderItems:function(t,a,r){var n,i,s=this,o=s.get("sugConfig").resultFormat,u=s.resultArr||(s.resultArr=[]),c="",l=t;e.each(a,function(t,s){if(!t||!t[0])return void a.splice(s,1);for(n=t[0];n.indexOf(l)<0;)l=l.substr(0,l.length-1);""===l?(c=n,n=""):0===n.indexOf(l)&&(c=l,n=n.replace(l,""));for(var f in u)if(i=u[f],i.textContent===t[0]&&i.unique)return;r=r.replace("{format}",o),u.push({textContent:t[0],content:e.substitute(r,{query:c,text:n,index:s+1,count:t[1]}),list:!0})}),s.resultArr=u},alignInternal:function(e){var t=this,a=t.constructor.superclass.alignInternal;return t.fire("beforeShow",{event:e})===!1?!1:void a.apply(this,arguments)}},{ATTRS:{dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},mods:{value:{},setter:function(e){return e}}}}),a.RemoteDataSource=r.RemoteDataSource,a.LocalDataSource=r.LocalDataSource,t=a}(),i=function(e){return e={"new":{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-xp" data-key="q={$queryUrl}&suggest=new_{$index}&tab=shopping&auction_tag[]=1154"><span class="{prefixCls}menu-xp-tag">新品</span><span class="{prefixCls}menu-xp-icon">新品</span><span class="{prefixCls}menu-xp">“{$query}”相关{new}新品</span></div>'},shop:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-action="//shopsearch.taobao.com/search" data-key="q={$queryUrl}&suggest=shop_{$index}"><span class="{prefixCls}menu-dp">{$query} <b>相关店铺</b></span><span class="{prefixCls}menu-dp-icon">店铺</span></div>'},cat:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$2}&cat={$1}&suggest=cat_{$index}"><span class="{prefixCls}menu-key">{$2}</span><span class="{prefixCls}menu-cate">在<b>{$0}</b>分类下搜索</span></div>'},list:{tmpl:"<div data-index='{index}' class='item-wrapper' data-key='q={textContent}&suggest=0_{index}'><span class='item-text'>{query}<b>{text}</b></span><span class='item-count'>{format}</span></div>"},global:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$queryUrl}&promote=2097152&suggest=global_{$index}"><span class="{prefixCls}menu-key">{$query}</span><span class="{prefixCls}menu-cate">在全球购市场中搜索</span></div>'},history:{tmpl:'<div class="{prefixCls}menu-extras-history" {attr} data-key="q={historyItemQuery}&suggest={extraParam}_{index}" data-index="_his_{index}" data-value="{historyItemValue}"><span class="{prefixCls}menu-history-key">{historyItemValue}</span><span data-type="{extraParam}" class="{prefixCls}menu-history-delete">删除</span></div>'},scene:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-scene" data-action="//fa.taobao.com/search" data-key="q={scene}&suggest=scene_{$index}"><span class="{prefixCls}menu-key">{scene}</span><b>装修宝典/选购秘籍</b></div>'},dapei_bottom:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-source-stat="source_click=suggest_kfc&source_pv=suggest_kfc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_bottom}"><span class="{prefixCls}menu-dp">{dapei_bottom}<b>全套搭配</b></span></div>'},dapei_top:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-source-stat="source_click=suggest_jqc&source_pv=suggest_jqc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_top}"><span class="{prefixCls}menu-key">{dapei_top}</span><span class="{prefixCls}menu-cate">在<b>搭配</b>下搜索</span></div>'},tmall:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-mall" data-key="q={tmall}&suggest=tmall_{$index}&tab=mall"><span class="{prefixCls}menu-key">{tmall}</span><b>天猫相关</b></div>'},c2c_activity:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-active" data-key="q={c2c_activity_query} {c2c_activity_tag}&suggest=active_{$index}&tab=deal"><span class="{prefixCls}menu-key">{c2c_activity_query}</span><span class="{prefixCls}menu-cate">在 <b>{c2c_activity_tag}</b> 中搜索</span></div>'},showExtra:!1}}(),s=function(t){function a(e){return r?r:(a.superclass.constructor.call(this,e||{}),void(r=this))}var r,n=g;return e.extend(a,n,{pluginInitializer:function(e){var t=this;t.set("caller",e)},getCookie:function(t){var a=window;if(a.userCookie&&!e.isUndefined(a.userCookie[t]))return a.userCookie[t];if(a.SRP_COOKIES||(a.SRP_COOKIES={})&&e.isUndefined(SRP_COOKIES[t])){var r=document.cookie.match("(?:^|;)\\s*"+t+"=([^;]*)");SRP_COOKIES[t]=r&&r[1]?decodeURIComponent(r[1]):""}return SRP_COOKIES[t]},fireEvent:function(e,t){var a=document;if(a.createEvent){var r=a.createEvent("MouseEvents");r.initEvent(t,!0,!1),e.dispatchEvent(r)}else a.createEventObject&&e.fireEvent("on"+t)}},{ATTRS:{pluginId:{value:"utils"}}}),t=a}(),o=function(t){function a(e){return r||(a.superclass.constructor.call(this,e||{}),r=this,r.initialize()),r}var r,n=g,i=p;return a.ATTRS={src:{value:location.protocol+"//g.alicdn.com/tbc/search-suggest/1.3.7/storage.swf"},bridge:{value:null},hasInit:{value:!1}},e.extend(a,n,{initialize:function(t){t=t||{};var a=this;try{a._addFlash(t.appendTo),a.hasInit=!0}catch(r){e.log(r.message)}},_saveToArr:function(e,t){var a=this.lazyArr||[];a.push({func:e,args:t}),this.lazyArr=a},_addFlash:function(t){var a,r=this,n=document,i=n.createElement("div"),s=r.get("src"),o="";window.__StorageIsReady=function(t){r.isLoaded=!0;var a=r.lazyArr;e.each(a,function(e){e.func.apply(r,e.args)})},i.id="storagetool",i.style.height=0,i.style.overflow="hidden",o+='<object id="J_StorageObj" name="J_StorageObj" ',o+='classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" ',o+='codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab">',o+='<param name="movie" value="'+s+'" />',o+='<param name="allowScriptAccess" value="always" />',o+='<embed name="J_StorageEmbed" src="'+s+'" width="1" height="1" ',o+='allowScriptAccess="always" type="application/x-shockwave-flash" ',o+='pluginspage="http://www.adobe.com/go/getflashplayer">',o+="</embed></object>",t=t||n.body,t.appendChild(i),i.innerHTML=o,-1!==navigator.appVersion.indexOf("MSIE")?(i.style.zoom=1,i.style.filter="alpha(opacity=10)",a=window.J_StorageObj):(i.style.opacity=.1,a=n.J_StorageEmbed),r.set("bridge",a)},save:function(e,t,a,r){var n=this,s=n.get("bridge");if(!n.isLoaded)return void n._saveToArr(arguments.callee,arguments);try{return s.save(e,t),s.read(e)?i.parse(s.read(e)).length:(a&&a.onSuccess(val),0)}catch(o){a&&a.onFailure&&a.onFailure(o)}},read:function(e,t,a){var r,n=this,i=n.get("bridge");if(a=a||0,!n.isLoaded)return void n._saveToArr(arguments.callee,arguments);try{if(i.read)r=i.read(e),t&&t.onSuccess(r);else{if(200===a)return void(t&&t.onFailure&&t.onFailure(s));setTimeout(function(){n.read(e,t,a+1)},500)}return r}catch(s){t&&t.onFailure&&t.onFailure(s)}}}),t=a}(),u=function(t){function a(e){a.superclass.constructor.call(this,e||{})}var r=g,n=s;return e.extend(a,r,{getBucket:function(){var e=this,t=e.getCookieT(),a=e.getTestBucket()||e.retBucket(t,20,-4,4)-0;return a},getTestBucket:function(){var e=location.search,t=e.match(/alg_bts=(\d+)/);return t&&t[1]?t[1]-0:void 0},getCookieT:function(){var e=new n,t=e.getCookie("t");return t},retBucket:function(e,t,a,r){return!e&&"0"||this.countBucket(e,t,a,r)},countBucket:function(e,t,a,r){var n=e.substr(a,r),i=parseInt(n,16),s=i%t+1;return s+""}},{ATTRS:{pluginId:{value:"bts"}}}),t=a}(),c=function(t){function a(e){a.superclass.constructor.call(this,e||{}),this.initialize()}var r=g,n=p,i=o,s="localQuery";return e.extend(a,r,{initialize:function(){var e=this,t=e.get("name"),a=e.get("tab"),r=e.get("user");"item"===a&&(a="baobei"),e.storageKey=s+t+a+r,e._getStorage()},checkFlash:function(e){this.storage.read(e)},_setKey:function(e){var t=this,a=e.name||t.get("name"),r=e.tab||t.get("tab"),n=e.user||t.get("user");"item"===r&&(r="baobei"),t.storageKey=s+a+r+n,t.set("tab",r),t.set("name",a),t.set("user",n),this.datalist=null},_save:function(t,a){if(!t.match(/<>'"/)&&!a.match(/<>'"/)){var r=this._getDatalist(),n=encodeURIComponent(t),i={key:n,value:encodeURIComponent(a),time:e.now()};this._deleteItemByValue(r,n),r.unshift(i)}},_deleteItemByValue:function(e,t){for(var a,r=null,n=0;n<e.length;n++)a=e[n].key,a==t&&(r=e.splice(n,1),n--)},_query:function(t){var a,r,n=this._getDatalist(),i=[];return t?(t=encodeURIComponent(t),e.each(n,function(e,n){a=e.key,r=e.value,(0===a.indexOf(t)||0===r.indexOf(t))&&i.push(e)}),this._distinctByValue(i)):this._distinctByValue(n)},_distinctByValue:function(e){for(var t,a=[],r=0,n=e.length;n>r;r++)t=e[r],t.value.match(/%3C|%3E|[<>'"]/g)||!this._hasItemOfValue(a,t.value)&&a.push(t);return a},_hasItemOfValue:function(e,t){for(var a=!1,r=e.length-1;r>=0;r--)e[r].value===t&&(a=!0);return a},_cleanBefore:function(e){for(var t,a=this._getDatalist(),r=0,n=a.length-1;n>=0;n--)if(t=a[n],t.time>e){r=n+1;break}a.length=r},_getDatalist:function(){return this.datalist||(this.datalist=this.storage.read()||[]),this.datalist},_getStorage:function(){var e=this.get("storageType");switch(e){case"flashStorage":this.storage=this._initFlashStorage();break;default:this.storage=!1}},_initFlashStorage:function(){var e=this;return{save:function(){return(new i).save(e.storageKey,n.stringify(e.datalist))},read:function(t){var a=(new i).read(e.storageKey,t);if(a){var r=n.parse(a);return r}return void 0}}},destructor:function(){this.datalist=null,s=null},save:function(t,a){if(""!=a){var r,n=this.storage.read();n&&(r=n.length);var i=this._save(t,a),s=this.storage.save();return r>300&&(this.datalist=this.datalist.slice(0,r-10),e.log("add_before\n"+s+"\n"+r),s=this.storage.save(),e.log("add_after\n"+s+"\n"+r)),i}},query:function(e){return this._query(e)},deleteItem:function(t){var a=this._getDatalist(),r=a.length;this._deleteItemByValue(a,encodeURIComponent(t));var n=this.storage.save();r>300&&(this.datalist=this.datalist.slice(0,r-10),n=this.storage.save(),e.log("delete\n"+n+"\n"+r))},clearByDay:function(t){var a=e.now()-24*t*3600*1e3;this._cleanBefore(a),this.storage.save()},hasHistory:function(){return this._getDatalist().length>0?!0:!1}},{ATTRS:{name:{value:"default",setter:function(e){return e}},user:{value:"",setter:function(t){return e.fromUnicode(t)}},maxLength:{value:500},storageType:{value:"flashStorage",setter:function(e){return e},getter:function(e){return e}}}}),t=a}(),l=function(t){function a(e){a.superclass.constructor.call(this,e||{})}var r=g,n=h,i=c;return e.extend(a,r,{pluginInitializer:function(e){var t=this,a=t.get("stat");t.set("caller",e),e.on("beforeSubmit",function(e){var a=e.isInitSearch;t.setStat(a)}),a&&(t.sendTongji(),t.bindSearchTrace())},bindSearchTrace:function(){var e=this;n.delegate("body","click","a",e.initSearchTrace,e)},initSearchTrace:function(e){var t=this,a=e.currentTarget,r=a.getAttribute("trace"),n=a.getAttribute("href");if(r)switch(r){case"relatedSearch":t.saveQuery();break;case"auction":var i=t.stat;i&&-1===n.indexOf("initiative_new")&&a.setAttribute("href",n+"&initiative_new=1")}},sendTongji:function(){var e,t=this,a=t.getStatInst();a.checkFlash({onSuccess:function(){e=a.query("stat")[0],e&&e.value&&(t.stat=e.value,t.send("f_stats_show="+e.value,!0))}})},setStat:function(e,t){var a=this,r=a.get("caller"),n=r.query,i=a.saveQuery(n,e);i&&a.send("lf_aclog=null-null-null-null-0&stats_click="+i,t)},getStatInst:function(){var e=this,t=e.get("caller"),a=t.get("sugConfig"),r=a.tab||"",n=new i({name:"stat",tab:r});return n},saveQuery:function(e,t){var a,r,n=this.getStatInst();return t&&e?(a=encodeURIComponent(e),r="initiative_new:1;q:"+a,n.save("stat",r)):n.deleteItem("stat"),r},send:function(e,t){var a,r;t?(a="/tongji",r="H51884970"):(a="/search",r="H51884969"),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[a,"",e,r]})},renderPlugin:function(){}},{ATTRS:{pluginId:{value:"stat"}}}),t=a}(),f=function(t){var a=m,r=v,o=b,c=n,f=i,d=u,g=s,p=l,h=(a.all,r.extend([],{initializer:function(){var e=this;e._initCombo(),e.bindUtil()},bindUtil:function(){var e=this;e.Utils=new g,e.Stat=new p},_setComboCache:function(e){var t=this,a=t.get("tab");t.configArr=t.configArr||[],t.configArr[a]={data:e}},_checkHasTab:function(){var e=this,t=e.getPlugin("tab");t||(e.tabNode=e.get("form"))},_initComboEvent:function(){var t=this,a=t.comboBox,r=a.get("input");r.on("mousedown",function(n){if(t.fire("beforeFocus")!==!1){var i=e.trim(r.val()),s=t.get("sugConfig"),o=!0;o&&(s.autoCollapsed||""===i)&&a.sendRequest(i)}n.stopPropagation()}),r.on("focus",function(){t.fire("beforeFocus")}),r.on("blur",function(){return t.fire("beforeBlur")===!1?!1:void 0});var n=t.get("sugConfig").itemClick,i=!0;if(n&&e.isFunction(n)){i=!1;var s=n.apply(this,arguments);s!==!1&&(i=!0)}i&&a.on("click",t.comboClick,t),a.on("afterCollapsedChange",t._addExtraEvent,t),a.on("afterCollapsedChange",function(e){t.fire("afterCollapsedChange",e)}),a.on("beforeQueryChange",function(e){t.fire("beforeQueryChange",e)}),a.on("beforeSetInputValue",function(){var e=t.get("label");e&&o.hide(e)}),t._formSubmitEvent(),t.query=r.val();var u=t.get("label");u&&u.on("click",function(){a.sendRequest(r.val())})},_formSubmitEvent:function(){var t,a=this,r=a.comboBox,n=r.get("input"),i=n.parent("form"),s=r.get("input");i.on("submit",function(r){a.fire("beforeSubmit",{el:i,isInitSearch:!0})!==!1?(t=i.attr("action"),""===e.trim(s.val())&&a._emptyJump(i)===!1&&r.preventDefault(),a.serializeToForm(i,t)):r.halt()})},serializeToForm:function(e,t){var a,r,n,i="",s="";if(t&&e){if(t.indexOf("http")>-1){if(-1===t.indexOf("?"))return;i=t.split("?")[1]}a=i.split("&");for(var o in a)r=a[o].split("="),n=r[0],n&&!e[0][n]&&(s+='<input type="hidden" name="'+r[0]+'" value="'+r[1]+'"/>');e.append(s)}},_defaultPageJump:function(t){var a,r=this,n=r.tabNode;if(!n)return!1;if(a=t.attr("data-defaultpage")||n.attr("data-defaultpage")){if(!e.startsWith(a,"http"))return!1;t.attr("action",a)}},_emptyJump:function(e){{var t,a=this,r=e.one("label"),n=a.get("sugConfig");n.tab}return r?(t=r.one("span"),t&&""!==t.text()?(r.hide(),void a._holderJump(e,t.text())):a._defaultPageJump(e)):a._defaultPageJump(e)},_holderJump:function(e,t){var a=e[0].q;a&&(a.value=t),e.append('<input type="hidden" name="style" value="grid" />')},_sendSnapshot:function(t){for(var a=this,r=[],n=-1,i=0;i<t.children.length;i++){var s=t.children[i];t.selected==s.value?n=i:r.push(s.value+"/"+s.index)}var o="f_stats_show=xialalist:";o+=r.join(","),o=o+";query:"+t.query,o=o+";selected:"+t.selected+"/"+n,o=o+";time:"+e.now(),o=o+";nick:"+a.getNick(),a.Stat.send(o,!0)},comboClick:function(e){var t,r=this,n=e.target.get?e.target.get("el"):a.one(e.currentTarget),i=r.comboBox,s=n.one(".item-text, .search-menu-key, .search-menu-history-key"),o=!1,u=r.get("form"),c=r.get("sugConfig").isSendByForm;if(s){t=s.text();var l=r.historyArr;if(l)for(var f=0,d=l.length-1;d>=f;f++)if(t===l[f]){o=!0;break}}for(var g=i.get("menu"),p=g.get("children"),h=[],f=0;f<p.length;f++){var m=p[f],v=m.get("value");v&&h.push({index:f,value:v[0]})}var b={query:r.query||"",children:h,selected:t||""};if(r._sendSnapshot(b),r.fire("beforeSubmit",{el:n,isInitSearch:!1,isNotSave:o})!==!1){var y=r.getRedirect(n);c?(r.serializeToForm(u,y),u[0].submit()):r.redirect(y)}},getRedirect:function(e){var t=this,a=(t.comboBox,t.query),r=t.query,n=o.children(e),i=o.attr(n,"data-key")||"q="+a,s=t.get("form")[0],u=o.attr(s,"action"),c=o.attr(n,"data-action")||t.get("action")||u,l=o.attr(n,"data-source-stat")||"source=suggest",f="&_input_charset=utf-8&wq="+encodeURIComponent(r)+"&suggest_query="+encodeURIComponent(a)+"&"+l,d=t._getInputsVal(s);return c+=c.indexOf("?")>-1?"&":"?",c+d+"&"+i+f},redirect:function(e){var t=this,a=t.get("sugConfig").isEncode;a?e=t.urlEncode(e):(e=e.replace(/(#)[^!]/g,function(e,t){return e.replace(t,"%23")}),e=e.replace(/#!/g,"#"));var r=document.createElement("a");r.setAttribute("href",e),r.setAttribute("target","_self"),r.style.display="none",document.body.appendChild(r),r.click()},urlEncode:function(t){var a=/[\u4e00-\u9fa5\uf900-\ufa2d+#\s]+/g.exec(t);if(a)try{t=t.replace("？","?"),t=t.replace(/[\u4e00-\u9fa5\uf900-\ufa2d+#]+/g,function(e){return encodeURIComponent(e)}),t=t.replace(/\s/g,function(e){return"+"}),t+="&ie=utf-8"}catch(r){e.log("url编码出错!")}return t},_getInputsVal:function(t){var a,r,n=this,i=n.get("sugConfig"),s=i.excludeParam,u=[];inputs=o.query("input",t);for(var c=inputs.length-1;c>=0;c--)a=inputs[c],r=a.name,r&&!e.inArray(r,s)&&u.push(r+"="+encodeURIComponent(a.value));return u.length<1?"":"&"+u.join("&")},_getDefComboCfg:function(){return{focused:!1,hasTrigger:!1,matchElWidth:!0,srcNode:".allWidth",highlightMatchItem:!1,menu:{align:{overflow:{adjustY:0}}},cache:!0}},_prepareHtml:function(e){var t=this,r=o.get(e.node),n=r.innerHTML,i=e.prefixCls,s=o.get(e.placeholderEl),u=s?s.outerHTML:"",c='<div class="{cls}combobox"><div class="{cls}combobox-input-wrap"></div></div>',l=c.replace(/{cls}/g,i).replace(/{label}/g,u).replace(/{input}/g,n),f=o.create(l),d={"aria-haspopup":"true","aria-combobox":"list",role:"combobox",autocomplete:"off","class":i+"combobox-input","x-webkit-grammar":"builtin:translate"};return o.attr(r,"aria-label")||(d["aria-label"]=t._isOpen("history")?"请输入搜索文字或从搜索历史中选择":"请输入搜索文字"),o.attr(r,d),o.wrap(r,f),this.get("sugConfig").focused&&o.get(r).focus(),a.one("."+i+"combobox")},_isOpen:function(t){var a=this,r=a.get("mods"),n=r.sort;return e.inArray(t,n)},_getRenderMods:function(){var t=this,a=e.merge(f,t.get("mods"));t.set("mods",a)},_getDataSourceCfg:function(){var t=this,a=t.get("sugConfig"),r=t.get("dataSourceCfg"),n=a.sourceUrl;return location.href.indexOf("debug=test")>-1&&(n=n.replace("suggest.taobao.com/sug?","suggest.proxy.taobao.org/sug?")),-1===n.indexOf("bucketid")&&(n+="&bucketid="+t._getBucketId()),r.xhrCfg.url=n,r.parse=e.bind(t.parse,t),r},_getBucketId:function(){return(new d).getBucket()},_getComboCfg:function(t){var r=this,n=r.get("sugConfig"),i=r._getDefComboCfg(),s=n.prefixCls,o=a.one("."+s+"-combobox");return o||(o=r._prepareHtml(n)),i.srcNode=o,i.dataSource=t,i.format=e.bind(r.format,r),i.prefixCls=n.prefixCls,i.holderEl=a.one(n.placeholderEl),i.maxItemCount=i.maxItemCount||t.maxItemCount,i},_initCombo:function(){var e,t,a=this,r=a._getDataSourceCfg(),n=a.get("sugConfig");a._getRenderMods(),n.sourceUrl?(e=new c.RemoteDataSource(r),e.maxItemCount=10):(e=new c.LocalDataSource(r),e.maxItemCount=0),a._setComboCache(e),t=a._getComboCfg(e);var i=new c(t);i.render(),a.comboBox=i,a._checkHasTab(),a._initComboEvent()},update:function(t){for(var a=this,r=a.get("plugins"),n=0,i=r.length-1;i>=n;n++){var s=r[n];s&&e.isFunction(s.update)&&s.update.call(s,t)}},parse:function(t,a){var r,n=this,i=n.fire("beforeParse",{results:a,query:t});if(i===!1)return[[""]];if(i&&(a=i),!a||!a.result)return e.log("接口无数据!"),[[""]];r=a.result,delete a.result;var s=n.comboBox.get("dataSource");if((s.extraData||(s.extraData=[]))[t]=a,0===r.length)return[[""]];for(var o in r)r[o]||r.splice(o,1);return r},format:function(e,t){var a=this;return a.resultArr=[],a.render(e,t),a.resultArr},render:function(e,t){var a,r,n,i,s,o,u=this,c=u.get("mods"),l=c.sort,f=u._adjustExtra(e,c.showExtra);u.query=e;for(var d=0,g=l.length-1;g>=d;d++)if(o=l[d])if("list"!==o){if(s=u.getPlugin(o),s&&s.renderPlugin)s.renderPlugin({query:e,results:t});else if(r=c[o],r&&f&&(!(i=r.pos)||n!==i)){if(a=r.tmpl,!a)continue;var p=u.resultArr.length,h=u.diffLen||0;n=u.defaultRender({tmpl:a,name:o,pos:i,always:r.always&&t.length>0,callback:r.callback,index:p-h})}}else r=c[o],a=r.tmpl,u._list(e,t,a);u.fire("afterQueryChange",{query:e})},defaultRender:function(t){var a,r=this,n=t.tmpl,i=t.name,s=r.comboBox.get("dataSource"),o=r.query,u=r.get("sugConfig").prefixCls,c=s.extraData,l=t.pos,f=t.index;if(c&&c[o]||t.always){var d,g,p=r._getDate(),h={$query:o,$queryUrl:encodeURIComponent(o),$date:p,prefixCls:u};if(!t.always){if(d=c[o][i],g=!0,!d)return;if(e.isArray(d)){d.length>2&&(d.length=2);for(var m=0,v=d.length-1;v>=m;m++){var b=d[m];if(e.isArray(b)){g=!1;for(var y=0,_=b.length-1;_>=y;y++)h["$"+y]=b[y]||"";h.$index=f+1+m,a=e.substitute(n,h),r.addContent({html:a,query:o,position:l,callback:t.callback})}else h["$"+m]=b,h.$index=f+1+m}return g&&(a=e.substitute(n,h),r.addContent({html:a,query:o,position:l,callback:t.callback})),l}if(e.isObject(d)){for(var x in d)h[i+"_"+x]=d[x];"active"===i&&(h.$query=d.query+" "+d.tag)}else h[i]=d,h.$query=d}return h.$index=f+1,a=e.substitute(n,h),r.addContent({html:a,query:h.$query||o,position:l,callback:t.callback}),l}},_adjustExtra:function(e,t){return""!==e?!0:!1},getNick:function(){var e=this;return e._getCookie("lgc")||e._getCookie("tracknick")},_getCookie:function(t){var a=window;if(a.userCookie&&!e.isUndefined(a.userCookie[t]))return a.userCookie[t];if(a.SRP_COOKIES||(a.SRP_COOKIES={})&&e.isUndefined(SRP_COOKIES[t])){var r=document.cookie.match("(?:^|;)\\s*"+t+"=([^;]*)");SRP_COOKIES[t]=r&&r[1]?decodeURIComponent(r[1]):""}return SRP_COOKIES[t]},_getDate:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+(e.getDate()+1)},_list:function(t,a,r){var n,i=this,s=i.get("sugConfig").resultFormat,o=i.resultArr||(i.resultArr=[]);e.each(a,function(i,u){if(!i||!i[0])return void a.splice(u,1);var c,l=i[0],f="",d=t;if(l.match(/<b>/))n=l.replace(/<b>(\S+?)<\/b>/g,function(e,t){return t}),f=l,l="";else{for(;l.indexOf(d)<0;)d=d.substr(0,d.length-1);""===d?(f=l,l=""):0===l.indexOf(d)?(f=d,l=l.replace(d,"")):(f=l,l=""),n=i[0]}for(var g in o)if(c=o[g],c.textContent===i[0]&&c.unique)return;r=r.replace("{format}",s),o.push({textContent:n,content:e.substitute(r,{query:f,text:l,index:u+1,count:i[1],textContent:encodeURIComponent(n)}),list:!0})}),i.resultArr=o},addContent:function(e){var t=this,a=e.html,r=e.position,n=e.query;if(!r){var i=t.resultArr||[];return void i.push({content:a,textContent:n})}t["__"+r]={tmpl:a},t._addExtraEvent()},_renderHeader:function(e,t,r){var n=t&&t.type+"-header"||"";if(t){var i=this.get("sugConfig").prefixCls;e||(e=new a("<div class='"+i+"combobox-menu-header "+n+"'></div>").prependTo(r)),e.empty().append(t.tmpl)}else e&&e.remove()},_renderFooter:function(e,t,r){var n=this,i=n.get("sugConfig").prefixCls,s=t&&t.type+"-footer"||"";if(t){e||(e=new a("<div class='"+i+"combobox-menu-footer "+s+"'></div>").appendTo(r)),t.css&&e.css(t.css),e.empty().append(t.tmpl);var o=e.one("."+i+"menu-history-clean");o&&o.on("click",function(e){e.halt();var t=n.getPlugin("history");t._cleanHistory()})}else e&&e.remove()},_addExtraEvent:function(e){var t=this,a=t.comboBox||t,r=t.__header,n=t.__footer,i=t.__lastHeader,s=t.__lastFooter,o=t.get("sugConfig").prefixCls;if(!e||e&&!e.newVal){var u=a.get("menu");if(!u.get)return;var c=u.get("el");if(!c||c.all("."+o+"menuitem").length<1)return;var l=c.one("."+o+"combobox-menu-header"),f=c.one("."+o+"combobox-menu-footer");i!==r&&(t.__lastHeader=r,t._renderHeader(l,r,c)),s!==n&&(t.__lastFooter=n,t._renderFooter(f,n,c))}else t.__header=null,t.__footer=null}},{ATTRS:{sugConfig:{value:{extraPassParams:"",extraPostParams:"",sourceUrl:"",tab:"item",autoCollapsed:!0,focused:!1,prefixCls:"search-",excludeParam:["q"],resultFormat:"约{count}个宝贝"},setter:function(t){var a=this.get("sugConfig");return e.mix(a,t,void 0,void 0,!0)}},mods:{value:{},setter:function(e){return e}},input:{getter:function(e){return e||(e=this.comboBox.get("input"))}},form:{getter:function(e){return e||(e=this.get("input").parent("form"))}},label:{getter:function(e){return e||(e=this.comboBox.get("holderEl"))}},menu:{getter:function(e){return e||(e=this.comboBox.get("menu"))}},dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}}}}));return t=h}(),r.exports=f});!function(e,t){function o(){}try{t(e)}catch(n){e.Log={info:o,warn:o,error:o,debug:o}}var r="tbc/log/0.4.2/index",i=function(){return e.Log};"undefined"!=typeof KISSY?KISSY.add(r,[],i):"undefined"!=typeof define&&define(r,[],i)}("undefined"!=typeof window?window:this,function(e){function t(t){var o=location.href.indexOf("ks-debug")>-1||location.href.indexOf("log-tools")>-1;o&&(this.console=t&&t.console||e.console)}function o(){function t(e,t,o){e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent?e.attachEvent("on"+t,o):e["on"+t]=o}var o=this;if(!e._console){var n=[];_console={log:function(){var e=arguments;n.push(function(t){t.log.apply(t,e)})},iterator:function(e){for(var t,o=0;t=n[o++];)t(e)}}}t(document,"keydown",function(e){var t=e.target,n=t&&t.tagName;!e.metaKey&&!e.ctrlKey||e.shiftKey!==!0||190!==e.keyCode||"INPUT"===n||"SELECT"===n||"TEXTAREA"===n||t.isContentEditable||(e.preventDefault(),o.show())}),location.search.indexOf("log-tools")>-1&&this.show()}function n(e){e=e||{},this.url=e.url||location.host+location.pathname,this.random=Math.random(),this.server="//poc.taobao.com/1.gif?"}function r(t){t=t||{},this.sampling=t.sampling||1e3,this.startTime=t.startTime||e.g_config&&g_config.startTime||+new Date,this.screen=t.screen||screen.width+"x"+screen.height,this.ua=t.ua||navigator.userAgent,this.url=t.url||location.protocol+"//"+location.host+location.pathname+"/log",this.random=Math.random(),this.server=(location>"https"?"//log":"//gm")+".mmstat.com/jstracker.2?"}function i(e){this.group=e,i.loggers[e]=this}function s(e,t){if(e.indexOf)return e.indexOf(t);for(var o=0,n=e.length;n>o;++o)if(e[o]===t)return o;return-1}function l(e){for(var t=1,o=arguments,n=o.length,r=String(e).replace(c,function(e){if("%%"===e)return"%";if(t>=n)return e;switch(e){case"%s":return String(o[t++]);case"%d":return Number(o[t++]);default:return e}}),i=o[t];n>t;i=o[++t])r+=" "+i;return r}t.prototype={receive:function(e){if(this.console){var t=e.level,o=e.message,n=e.group,r="["+n+"] "+o;this.console[t]&&this.console[t](r)}}},o.prototype={isTestEnv:function(){var e=location.host,t=location.href;return e.indexOf("daily")>-1||e.indexOf("pre")>-1||t.indexOf("ks-debug")>-1||t.indexOf("log-tools")>-1}(),promptNum:0,promptId:"log-prompt",promptStyle:"cursor: pointer; position: fixed; _position: absolute; right: 5px; bottom: 5px; z-index: 2147483640;border-radius: 50px;background: rgba(0, 0, 0, 0.7);width: 48px;color: #f00;height: 48px;line-height: 48px;font-size: 24px;text-align: center;",showPrompt:function(){var e=document.getElementById(this.promptId);if(e)e.innerText=++this.promptNum;else{var t=this,o=document.createElement("div");document.body.appendChild(o),o.innerHTML='<div id="'+this.promptId+'" title="\u70b9\u51fb\u67e5\u770b\u9519\u8bef" style="'+this.promptStyle+'">'+ ++this.promptNum+"</div>",o.onclick=function(){o.parentNode.removeChild(o),t.show()}}},receive:function(t){var o=t.level,n=t.message,r=t.group,i=t.date;!this.isTestEnv||"warn"!=o&&"error"!=o||this.showPrompt(),e._console&&_console.log(o,r,n,i)},show:function(){if(_console.show)_console.show();else{_console.show=function(){};var t=document,o=t.head||t.getElementsByTagName("head")[0]||t.documentElement,n=o.getElementsByTagName("base")[0],r=+new Date,i="?"+r,s=t.createElement("link");s.rel="stylesheet",s.href=(e.LOG_TOOLS_CSS||"//g.alicdn.com/tbc/log-tools/index.css")+i,n?o.insertBefore(s,n):o.appendChild(s);var l=t.createElement("script");l.src=(e.LOG_TOOLS_JS||"//g.alicdn.com/tbc/log-tools/index.js")+i,n?o.insertBefore(l,n):o.appendChild(l)}}},n.prototype={receive:function(e){var t=e.level,o=e.message,n=e.group;this.send(this.server+["l="+(t+":"+n),"u="+this.url,"m="+o,"t="+(new Date).valueOf()].join("&"))},send:function(t){var o="__log_img_"+ +new Date,n=e[o]=new Image;n.onload=n.onerror=function(){e[o]=null},n.src=t,n=null}},r.prototype={receive:function(e){this.random*this.sampling>1||this.track(e)},track:function(e){var t=e.level,o=e.message,n=e.group,r={ua:this.ua,msg:o||"",nick:"",file:"",line:0,delay:+new Date-this.startTime,screen:this.screen,scrolltop:document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop||0,url:this.url,category:t+":"+n||"",sampling:this.sampling};try{var i=document.cookie,s=/_nk_=([^;]+)/.exec(i)||/_w_tb_nick=([^;]+)/.exec(i)||/lgc=([^;]+)/.exec(i);s&&(r.nick=s[1])}catch(l){}r.msg=["[u"+r.url+"]","[t"+r.delay+"]","[c"+r.category+"]","[r"+r.sampling+"]"].join("")+r.msg,this.send(this.server+["type=9","id=jstracker","v=0.02","ua="+encodeURIComponent(r.ua),"msg="+encodeURIComponent(r.msg),"nick="+decodeURIComponent(r.nick),"file="+encodeURIComponent(r.file),"line="+r.line,"screen="+r.screen,"scrolltop="+r.scrolltop,"t="+(new Date).valueOf()].join("&"))},send:function(t){var o="__log_img_"+ +new Date,n=e[o]=new Image;n.onload=n.onerror=function(){e[o]=null},n.src=t,n=null}},i.getLogger=function(e){return i.loggers[e]||new i(e)},i.reporters=[],i.loggers={},i.reporter=function(e,t){var o={level:["*"],group:["*"]};t=t||{},t.level||(t.level=o.level),t.group||(t.group=o.group);var n={reporter:e,config:t};return i.reporters.push(n),function(){i.reporters.splice(i.reporters.indexOf(n),1)}},i.prototype.reporter=function(){},i.prototype.log=function(e,t,o){try{for(var n in i.reporters){var r=i.reporters[n],l=r.config,c=r.reporter;if(!(-1===s(l.level,"*")&&-1===s(l.level,e)||-1===s(l.group,"*")&&-1===s(l.group,t)))try{c.receive({level:e,group:t,message:o,date:new Date})}catch(a){}}}catch(a){}};var c=/%[sd%]/g,a=["debug","info","warn","error"];for(var u in a){var p=a[u];i.prototype[p]=function(e){return function(t){t=l.apply(null,arguments),this.log(e,this.group,t)}}(p)}try{i.reporter(new o),i.reporter(new t),i.reporter(new r,{level:["warn","error"]}),i.reporter(new n,{level:["warn","error"]})}catch(d){}e.Log=i});/*! sku 2014-06-11 */
KISSY.add("tbc/sku/1.0.0/index",function(a){var b=a.all,c={root:"#J_SKU",hook:".J_SKU",skuMap:{},promoMap:{},stockMap:{},attrName:"data-pv",selectedClass:"tb-selected",disabledClass:"tb-disabled"},d=function(b){this.opts=a.merge(c,a.clone(b))};return a.augment(d,a.EventTarget),d.prototype.init=function(){var a=this;a.getPropertyIds(),a.normalizeSkuMap(),a.serializeSkuMap(),a.getSkuMapConfig(),a.bind()},d.prototype.bind=function(){var c=this,d=c.opts,e=d.root,f=d.hook,g=d.attrName,h=d.selectedClass,i=d.disabledClass,j=d.serializedSkuMap,k=b(f,e),l=function(){var d=[],e=c.props;return a.each(e,function(a){a&&d.push(a[0])}),b(d)},m=function(a){var b=[];return a.each(function(a){b.push(a.attr(g))}),b};b(e).delegate("click",f,function(d){var e=b(d.currentTarget),f=e.attr(g).split(":")[0],n=c.props;if(d.halt(),!e.hasClass(i)){n[f]=e.hasClass(h)?null:e,e.toggleClass(h).siblings().removeClass(h);var o=l(),p=[];o.length?(p=m(o),p=c.sortPropertyId(p),k.each(function(b){var d,f,k=[];a.inArray(b[0],o)||b[0]===e[0]||(d=b.siblings("."+h),d.length?(f=d.attr(g),a.each(p,function(a){a!==f&&k.push(a)})):k=p,k=k.concat(b.attr(g)),k=c.sortPropertyId(k),j[k.join(";")]?b.removeClass(i):b.addClass(i).removeClass(h))})):k.each(function(a){j[a.attr(g)]?a.removeClass(i):a.addClass(i).removeClass(h)}),c.fireCustomEvent(o,p)}}),k.each(function(a){0===a.siblings().length&&a.fire("click")})},d.prototype.getPropertyIds=function(){var a=this,c=a.opts,d=c.root,e=c.hook,f=c.attrName,g={};b(e,d).each(function(a){var b=a.attr(f).split(":")[0];b in g||(g[b]=null)}),a.props=g},d.prototype.sortPropertyId=function(a){return a.sort(function(a,b){return parseInt(a)-parseInt(b)}),a},d.prototype.mixDynamicPromo=function(b,c){return c&&!a.isEmptyObject(c)&&a.each(c,function(a,c){b[c]&&a.length&&(a[0].price&&(b[c].price=a[0].price),b[c].limit=a[0].amountRestriction)}),b},d.prototype.mixDynamicStock=function(c,d){var e=this,f=e.opts,g=f.root,h=f.hook,i=f.attrName,j=b(h,g),k={};return d&&!a.isEmptyObject(d)&&(a.each(c,function(b,e){var f=d[e];if(f&&f.stock){var g=e.split(";");a.each(g,function(a){k[a]=!0}),c[e].stock=f.stock,c[e].oversold=f.oversold}else delete c[e]}),j.each(function(a){var b=a.attr(i);b&&!k[b]&&a.remove()})),c},d.prototype.hasSku=function(){var b=this,c=b.opts,d=c.skuMap;return d&&!a.isEmptyObject(d)},d.prototype.isOverSold=function(){var a=this,b=a.getCurrentSku(),c=a.getDefaultStock();return c&&"0"===c.virtQuantity?!0:b&&"true"===b.oversold?!0:!1},d.prototype.setCurrentSku=function(c){var d=this,e=d.opts,f=e.root,g=e.hook,h=e.attrName,i=e.selectedClass,j=b(g,f),k=c.pvs;a.isString(k)&&(j.each(function(a){a.hasClass(i)&&a.fire("click")}),d.getPropertyIds(),j.each(function(a){var b=a.attr(h);~k.indexOf(b)&&a.fire("click")}))},d.prototype.getCurrentSku=function(){var a=this;return a.sku},d.prototype.getDefaultPromo=function(){var a,b=this,c=b.opts,d=c.promoMap,e=d.def;return e&&e.length&&(e=e[0],a={type:e.type,price:e.price,limit:e.amountRestriction,isStart:e.isStart,limitTime:e.limitTime}),a},d.prototype.getDefaultStock=function(){var a,b=this,c=b.opts,d=c.stockMap;return d&&(a={stock:d.stock,virtQuantity:d.virtQuantity}),a},d.prototype.normalizeSkuMap=function(){var b=this,c=b.opts,d=c.skuMap,e=c.promoMap,f=c.stockMap&&c.stockMap.sku,g=function(b){var c={};return a.each(b,function(a,b){var d;b=b.replace(/^;|;$/gi,""),d=b.split(";"),d.sort(function(a,b){return parseInt(a)-parseInt(b)}),c[d.join(";")]=a}),c};d=g(d),e=g(e),f=g(f),d=b.mixDynamicPromo(d,e),d=b.mixDynamicStock(d,f),c.skuMap=d},d.prototype.serializeSkuMap=function(){var b=this,c=b.opts,d=c.skuMap,e={},f=function(b,c){var d=[];if(c===b.length)return[b];if(1===c)a.each(b,function(a){d.push([a])});else for(var e=0;e<=b.length-c;e++){var g=b.slice(e,e+1),h=b.slice(e+1);a.each(f(h,c-1),function(a){d.push(g.concat(a))})}return d};a.each(d,function(b,c){for(var d=c.split(";"),g=b.stock,h=b.price,i=[],j=1;j<=d.length;j++)i=i.concat(f(d,j));g=parseInt(g),a.each(i,function(a){var b=a.join(";"),c=e[b];c?(c.stock+=g,c.prices.push(h)):e[b]={stock:g,prices:[h]}})}),c.serializedSkuMap=e},d.prototype.getSkuMapConfig=function(){var b=this,c=b.opts,d=c.skuMap;a.each(d,function(a,c){return b.length=c.split(";").length,!1}),b.lastSelectedLength=0},d.prototype.fireCustomEvent=function(b,c){var d=this,e=d.opts,f=e.skuMap,g=d.length,h=d.lastSelectedLength;d.fire("selectionChanged",{sku:{els:b,pvs:c.join(";")}});var i=c.length;if(i===g){var j,k=c.join(";"),l=f[k];l=a.merge(l,{els:b,pvs:k}),j=h===g?"skuChanged":"skuFound",d.sku=l,d.fire(j,{sku:l})}else d.sku=null,h===g&&d.fire("skuLost",null);d.lastSelectedLength=i},d},{requires:["node","event"]});